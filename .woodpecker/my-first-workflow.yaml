when:
  - event: [push, manual]
    branch: main

steps:
  build-deploy:
    image: docker:latest
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    commands:
      - docker compose down --remove-orphans
      - docker compose build --no-cache
      - docker compose up -d --force-recreate
      - docker image prune -f